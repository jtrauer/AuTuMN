from autumn.constants import Region
from apps.covid_19.calibration import base
from apps.covid_19.calibration.base import (
    provide_default_calibration_params,
    add_standard_dispersion_parameter,
    add_standard_philippines_params,
    assign_trailing_weights_to_halves,
)


def run_calibration_chain(max_seconds: int, run_id: int, num_chains: int):
    base.run_calibration_chain(
        max_seconds,
        run_id,
        num_chains,
        Region.CENTRAL_VISAYAS,
        PAR_PRIORS,
        TARGET_OUTPUTS,
        mode="autumn_mcmc",
    )

# START CALIBRATION VALUES
# Notification data:
notification_times = [
79,
99,
100,
101,
102,
103,
104,
105,
106,
107,
108,
109,
110,
111,
112,
113,
114,
115,
116,
117,
118,
119,
120,
121,
122,
123,
124,
125,
126,
127,
128,
129,
130,
131,
132,
133,
134,
135,
136,
137,
138,
139,
140,
141,
142,
143,
144,
145,
146,
147,
148,
149,
150,
151,
152,
153,
154,
155,
156,
157,
158,
159,
160,
161,
162,
163,
164,
165,
166,
167,
168,
169,
170,
171,
172,
173,
174,
175,
176,
177,
178,
179,
180,
181,
182,
183,
184,
185,
186,
187,
188,
189,
190,
191,
192,
193,
194,
195,
196,
197,
198,
199,
200,
201,
202,
203,
204,
205,
206,
207,
208,
209,
210,
211,
212,
213,
214,
215,
216,
217,
218,
219,
]

notification_values = [
3,
3,
3,
8,
15,
21,
25,
26,
27,
30,
37,
38,
38,
41,
50,
59,
59,
58,
67,
73,
113,
121,
121,
126,
130,
129,
132,
107,
98,
90,
82,
70,
58,
50,
41,
41,
45,
47,
46,
48,
55,
54,
52,
53,
56,
61,
64,
67,
72,
79,
82,
83,
88,
89,
91,
98,
118,
127,
131,
140,
161,
175,
184,
177,
180,
186,
185,
179,
177,
179,
179,
181,
186,
190,
195,
198,
207,
227,
238,
246,
270,
300,
320,
324,
323,
335,
337,
333,
316,
304,
299,
297,
283,
271,
253,
245,
253,
253,
239,
231,
230,
231,
243,
242,
232,
231,
231,
228,
222,
204,
189,
190,
180,
170,
167,
165,
158,
143,
123,
111,
107,
106,
]

# ICU data:
icu_times = [
110,
117,
124,
131,
138,
145,
152,
159,
166,
173,
180,
187,
194,
201,
208,
215,
222,
]

icu_values = [
3,
17,
20,
19,
21,
21,
26,
30,
32,
50,
60,
76,
82,
72,
80,
72,
56,
]

# END CALIBRATION VALUES

TARGET_OUTPUTS = [
    {
        "output_key": "notifications",
        "years": notification_times,
        "values": notification_values,
        "loglikelihood_distri": "negative_binomial",
        "time_weights": assign_trailing_weights_to_halves(5, notification_times),
    },
    {
        "output_key": "icu_occupancy",
        "years": icu_times,
        "values": icu_values,
        "loglikelihood_distri": "negative_binomial",
        "time_weights": list(range(1, len(icu_times) + 1)),
    },
]


PAR_PRIORS = provide_default_calibration_params()
PAR_PRIORS = add_standard_dispersion_parameter(PAR_PRIORS, TARGET_OUTPUTS, "notifications")
PAR_PRIORS = add_standard_dispersion_parameter(PAR_PRIORS, TARGET_OUTPUTS, "icu_occupancy")
PAR_PRIORS = add_standard_philippines_params(PAR_PRIORS)
